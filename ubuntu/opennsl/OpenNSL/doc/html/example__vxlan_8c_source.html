<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>OpenNSL API Guide and Reference Manual: examples/xgs/example_vxlan.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen_brcm.css" rel="stylesheet" type="text/css" />
<link href="tabs_brcm.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">OpenNSL API Guide and Reference Manual
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.2 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Welcome</span></a></li>
      <li><a href="pages.html"><span>OpenNSL&#160;Documentation</span></a></li>
      <li><a href="modules.html"><span>API&#160;Reference</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_d28a4824dc47e487b107a5db32ef43c4.html">examples</a></li><li class="navelem"><a class="el" href="dir_0a79fbcd3b9b61e45c34012618895dc0.html">xgs</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">example_vxlan.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="example__vxlan_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/******************************************************************************</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> * (C) Copyright Broadcom Corporation 2013-2016</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> *  Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> *  you may not use this file except in compliance with the License.</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> *  You may obtain a copy of the License at</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> *      http://www.apache.org/licenses/LICENSE-2.0</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> *  Unless required by applicable law or agreed to in writing, software</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> *  distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> *  See the License for the specific language governing permissions and</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> *  limitations under the License.</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> ******************************************************************************</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> * \file     example_vxlan.c</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"> * \brief    Example code for VxLAN application</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment"> * VXLAN is a L2 VPN technology targeted for Data-Center communication </span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment"> * between Virtual Machines (VM) assigned to the same customer(Tenant) that are </span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment"> * distributed in various racks in the Data-Center. L2VPN over IP/UDP tunnels can provide </span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment"> * E-LAN (similar to VPLS) and E-LINE (similar to VPWS) service. With VXLAN the ethernet </span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment"> * packets are encapsulated in UDP tunnels over an IP network. VXLAN uses UDP Source_Port</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment"> * as multiplexing field for multiplexing multiple VPNs into the same UDP Tunnel.</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment"> * E-LINE is point-to-point service without support for Multicast traffic. In E-LINE, Ethernet</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment"> * frames are mapped into a VXLAN Tunnel based on incoming port plus packet header information. </span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment"> * At the end of Tunnel, forwarding of Ethernet frames after Tunnel decapsulation is based on </span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment"> * VXLAN-VNID and Tunnel lookup.</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment"> * In E-LAN, Ethernet frames of interest are also identified by incoming port plus packet </span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment"> * header information. Ethernet frames are switched into one or more VXLAN Tunnels based </span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment"> * on the MAC DA lookup.  At the end of  Tunnel, forwarding of Ethernet frames after Tunnel </span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment"> * decapsulation is based on the VXLAN-VNID and Tunnel lookup and frames are again forwarded </span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment"> * based on MAC-DA lookup.</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment"> * VXLAN VPN can be of type ELINE or ELAN.</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment"> * For ELAN, a VPN is similar to a VLAN, which identifies a group of physical ports to be </span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment"> * included in a broadcast domain. However, instead of physical ports, a ELAN VPN identifies </span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment"> * a group of &quot;virtual-ports&quot; to be included in a broadcast domain. In the VXLAN APIs, </span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment"> * a &quot;virtual-port&quot; is called an VXLAN port (see description below). The VPN ID is used to </span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment"> * qualify MAC DA lookups within the VPN.</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment"> * For ELINE, a VPN consists of two VXLAN ports. Packets arriving on one VXLAN port are sent </span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment"> * directly out the other VXLAN port.</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment"> * This example application creates 2 VxLAN segments, and two access ports that share 1 tunnel:</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="comment"> *   Access Port1 --&gt; Segment 1 (VPN 1) \</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="comment"> *                                       +-&gt; share 1 network UDP tunnel</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment"> *   Access Port2 --&gt; Segment 2 (VPN 2) /</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment"> ******************************************************************************/</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="driver_8h.html">sal/driver.h</a>&gt;</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="opennsl_2error_8h.html">opennsl/error.h</a>&gt;</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="l2_8h.html">opennsl/l2.h</a>&gt;</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="opennsl_2switch_8h.html">opennsl/switch.h</a>&gt;</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="vlan_8h.html">opennsl/vlan.h</a>&gt;</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="tunnel_8h.html">opennsl/tunnel.h</a>&gt;</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="multicast_8h.html">opennsl/multicast.h</a>&gt;</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="vxlan_8h.html">opennsl/vxlan.h</a>&gt;</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="examples_2util_8h.html">examples/util.h</a>&gt;</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;</div>
<div class="line"><a name="l00071"></a><span class="lineno"><a class="code" href="example__vxlan_8c.html#adbb76aecfc5eef000cb4cb55bc2fd404">   71</a></span>&#160;<span class="preprocessor">#define DEFAULT_UNIT  0</span></div>
<div class="line"><a name="l00072"></a><span class="lineno"><a class="code" href="example__vxlan_8c.html#a91668ed1245d073a2ac84e6121205d28">   72</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define DEFAULT_VLAN  1</span></div>
<div class="line"><a name="l00073"></a><span class="lineno"><a class="code" href="example__vxlan_8c.html#a068278b0838b6670ab0ab0a93ed77484">   73</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define MAX_DIGITS_IN_CHOICE 5</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00075"></a><span class="lineno"><a class="code" href="example__vxlan_8c.html#afc7d01e6dbea2c820a68fb8081c58a89">   75</a></span>&#160;<span class="keywordtype">char</span> <a class="code" href="example__field__redirect_8c.html#afc7d01e6dbea2c820a68fb8081c58a89">example_usage</a>[] =</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="stringliteral">&quot;Syntax: example_vxlan                                                 \n\r&quot;</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="stringliteral">&quot;                                                                      \n\r&quot;</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="stringliteral">&quot;Paramaters: None.                                                     \n\r&quot;</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="stringliteral">&quot;                                                                      \n\r&quot;</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="stringliteral">&quot;Usage Guidelines: None.                                               \n\r&quot;</span>;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment">/* debug prints */</span></div>
<div class="line"><a name="l00083"></a><span class="lineno"><a class="code" href="example__vxlan_8c.html#a0b2caeb4b6f130be43e5a2f0267dd453">   83</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="example__link__monitor_8c.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a> = 3;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;</div>
<div class="line"><a name="l00085"></a><span class="lineno"><a class="code" href="example__vxlan_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">   85</a></span>&#160;<span class="preprocessor">#define TRUE  1</span></div>
<div class="line"><a name="l00086"></a><span class="lineno"><a class="code" href="example__vxlan_8c.html#aa93f0eb578d23995850d61f7d61c55c1">   86</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define FALSE 0</span></div>
<div class="line"><a name="l00087"></a><span class="lineno"><a class="code" href="example__vxlan_8c.html#a6771677c2de7aeda8be146d9068290e3">   87</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define VXLAN_UDP_DEST_PORT 4789</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment">/*****************************************************************/</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> do_vxlan_global_setting(<span class="keywordtype">int</span> unit)</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;{</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  <span class="comment">/* Enable L3 Egress Mode */</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  <a class="code" href="group__error.html#gaa1ed0c76c2846d4d337b3157ff73c823">OPENNSL_IF_ERROR_RETURN</a></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    (<a class="code" href="group__switch.html#gaecf4eb5e6b57081dc8f06c72919e4e0b" title="Configure port-specific and device-wide operating modes.">opennsl_switch_control_set</a>(unit, <a class="code" href="group__switch.html#gga8465f9bee535c4a0c8e4360bcc21e33ca99cbe7dac9fc5a734a46fdcf66b2e291" title="Enable advanced egress management.">opennslSwitchL3EgressMode</a>, <a class="code" href="example__vxlan_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>));</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  <span class="comment">/* Set UDP destination port for VXLAN */</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  <a class="code" href="group__error.html#gaa1ed0c76c2846d4d337b3157ff73c823">OPENNSL_IF_ERROR_RETURN</a></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    (<a class="code" href="group__switch.html#gaecf4eb5e6b57081dc8f06c72919e4e0b" title="Configure port-specific and device-wide operating modes.">opennsl_switch_control_set</a>(unit, <a class="code" href="group__switch.html#gga8465f9bee535c4a0c8e4360bcc21e33ca2bd885f05e90af619d58cb5c41fab717" title="Set UDP Destination port for VXLAN.">opennslSwitchVxlanUdpDestPortSet</a>,</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;                                <a class="code" href="example__vxlan_8c.html#a6771677c2de7aeda8be146d9068290e3">VXLAN_UDP_DEST_PORT</a>));</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  <span class="comment">/* Enable UDP Source port based HASH for VXLAN */</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;  <a class="code" href="group__error.html#gaa1ed0c76c2846d4d337b3157ff73c823">OPENNSL_IF_ERROR_RETURN</a></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    (<a class="code" href="group__switch.html#gaecf4eb5e6b57081dc8f06c72919e4e0b" title="Configure port-specific and device-wide operating modes.">opennsl_switch_control_set</a>(unit, <a class="code" href="group__switch.html#gga8465f9bee535c4a0c8e4360bcc21e33ca368d941467ad3d8e3476e409f34669a4" title="Set UDP Source port for VXLAN Tunnel Entropy(Value = TRUE/FALSE)">opennslSwitchVxlanEntropyEnable</a>, <a class="code" href="example__vxlan_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>));</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;  <span class="comment">/* Enable VXLAN Tunnel lookup failure settings to send packets to CPU. */</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;  <a class="code" href="group__error.html#gaa1ed0c76c2846d4d337b3157ff73c823">OPENNSL_IF_ERROR_RETURN</a></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    (<a class="code" href="group__switch.html#gaecf4eb5e6b57081dc8f06c72919e4e0b" title="Configure port-specific and device-wide operating modes.">opennsl_switch_control_set</a>(unit, <a class="code" href="group__switch.html#gga8465f9bee535c4a0c8e4360bcc21e33caed08e670fbc6f4756bfaea6703937f2e" title="If set, send a copy of VXLAN packet to CPU if VXLAN Tunnel lookup fails.">opennslSwitchVxlanTunnelMissToCpu</a>, <a class="code" href="example__vxlan_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>));</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  <span class="comment">/* Enable VXLAN VN_ID lookup failure settings to send packets to CPU. */</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  <a class="code" href="group__error.html#gaa1ed0c76c2846d4d337b3157ff73c823">OPENNSL_IF_ERROR_RETURN</a></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    (<a class="code" href="group__switch.html#gaecf4eb5e6b57081dc8f06c72919e4e0b" title="Configure port-specific and device-wide operating modes.">opennsl_switch_control_set</a>(unit, <a class="code" href="group__switch.html#gga8465f9bee535c4a0c8e4360bcc21e33ca3f37229fc8e28cdfad6e23be2fcb809b" title="Set VXLAN VN_ID lookup failure Copy to Cpu.">opennslSwitchVxlanVnIdMissToCpu</a>, <a class="code" href="example__vxlan_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>));</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;}</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="comment">/* __doxy_func_body_end__ */</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="comment">/*****************************************************************/</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> do_vxlan_access_port_settings(<span class="keywordtype">int</span> unit, <a class="code" href="group__types.html#gacaeba2b4ddbc89b0e556720a9388885f" title="Set the default tag protocol ID (TPID) for the specified port.">opennsl_port_t</a> a_port)</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;{</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  <span class="comment">/* Should disable Vxlan Processing on access port. VXLAN encapsulated packets are  </span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment">   * not expected on the access port.</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="comment">   */</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  <a class="code" href="group__error.html#gaa1ed0c76c2846d4d337b3157ff73c823">OPENNSL_IF_ERROR_RETURN</a></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    (<a class="code" href="group__port.html#gaadb3a3b151da4c086bb70045b577ef3f" title="Get or set various features at the port level.">opennsl_port_control_set</a>(unit, a_port, <a class="code" href="group__port.html#gga5379940dfdb23bbc238f5bb9fa6114c9a5e94e33b7b332d12c0aac86eb3c8a9cc" title="Set per port enable for VXLAN (Value=TRUE/FALSE)">opennslPortControlVxlanEnable</a>, <a class="code" href="example__vxlan_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>));</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;  <span class="comment">/* Should disable Tunnel Based Vxlan-VnId lookup */</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;  <a class="code" href="group__error.html#gaa1ed0c76c2846d4d337b3157ff73c823">OPENNSL_IF_ERROR_RETURN</a></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    (<a class="code" href="group__port.html#gaadb3a3b151da4c086bb70045b577ef3f" title="Get or set various features at the port level.">opennsl_port_control_set</a>(unit, a_port, <a class="code" href="group__port.html#gga5379940dfdb23bbc238f5bb9fa6114c9a22e32cbf6779567bb86f41d79407ff0c" title="Set per port VNID lookup key (Value=TRUE/FALSE)">opennslPortControlVxlanTunnelbasedVnId</a>, <a class="code" href="example__vxlan_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>));</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;  <span class="comment">/* Should Enable VLAN translation if access port uses 802.1Q or QinQ */</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  <a class="code" href="group__vlan.html#gafd2c2b34fb525b94d5cb2e14fb75044b" title="Set/get miscellaneous VLAN-specific chip options.">opennsl_vlan_control_set</a>(unit, <a class="code" href="group__vlan.html#gga2c2faca7a7fee163ce2efdf0e74d44efad3d63a7b7b26994677b9e27d0dbd1d11" title="Chip is in VLAN translate mode.">opennslVlanTranslate</a>, <a class="code" href="example__vxlan_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;}</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="comment">/* __doxy_func_body_end__ */</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="comment">/*****************************************************************/</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> do_vxlan_net_port_settings(<span class="keywordtype">int</span> unit, <a class="code" href="group__types.html#gacaeba2b4ddbc89b0e556720a9388885f" title="Set the default tag protocol ID (TPID) for the specified port.">opennsl_port_t</a> n_port)</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;{</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  <span class="comment">/* Enable VXLAN Processing on network port */</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  <a class="code" href="group__error.html#gaa1ed0c76c2846d4d337b3157ff73c823">OPENNSL_IF_ERROR_RETURN</a></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    (<a class="code" href="group__port.html#gaadb3a3b151da4c086bb70045b577ef3f" title="Get or set various features at the port level.">opennsl_port_control_set</a>(unit, n_port, <a class="code" href="group__port.html#gga5379940dfdb23bbc238f5bb9fa6114c9a5e94e33b7b332d12c0aac86eb3c8a9cc" title="Set per port enable for VXLAN (Value=TRUE/FALSE)">opennslPortControlVxlanEnable</a>, <a class="code" href="example__vxlan_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>));</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;  <span class="comment">/* Allow tunnel based VXLAN-VNID lookup */</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  <a class="code" href="group__error.html#gaa1ed0c76c2846d4d337b3157ff73c823">OPENNSL_IF_ERROR_RETURN</a></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    (<a class="code" href="group__port.html#gaadb3a3b151da4c086bb70045b577ef3f" title="Get or set various features at the port level.">opennsl_port_control_set</a>(unit, n_port, <a class="code" href="group__port.html#gga5379940dfdb23bbc238f5bb9fa6114c9a22e32cbf6779567bb86f41d79407ff0c" title="Set per port VNID lookup key (Value=TRUE/FALSE)">opennslPortControlVxlanTunnelbasedVnId</a>, <a class="code" href="example__vxlan_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>));</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  <span class="comment">/* Enable Default SVP on network side */</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  <a class="code" href="group__error.html#gaa1ed0c76c2846d4d337b3157ff73c823">OPENNSL_IF_ERROR_RETURN</a></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    (<a class="code" href="group__port.html#gaadb3a3b151da4c086bb70045b577ef3f" title="Get or set various features at the port level.">opennsl_port_control_set</a>(unit, n_port, <a class="code" href="group__port.html#gga5379940dfdb23bbc238f5bb9fa6114c9ab68bf32a1e094ee14119eac595ef13f8" title="Set per port dafult-SVP for Tunnel lookup failure(Value=TRUE/FALSE)">opennslPortControlVxlanDefaultTunnelEnable</a>, 0));</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;}</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="comment">/* __doxy_func_body_end__ */</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="comment">/*****************************************************************/</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> create_vxlan_vpn(<span class="keywordtype">int</span> unit, <span class="keywordtype">int</span> vpn_id, <span class="keywordtype">int</span> vnid, <a class="code" href="group__types.html#ga50bad717e3851cb2dd6acaac4d2a2f1b" title="opennsl_multicast_t">opennsl_multicast_t</a> bc,</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;                            <a class="code" href="group__types.html#ga50bad717e3851cb2dd6acaac4d2a2f1b" title="opennsl_multicast_t">opennsl_multicast_t</a> mc, <a class="code" href="group__types.html#ga50bad717e3851cb2dd6acaac4d2a2f1b" title="opennsl_multicast_t">opennsl_multicast_t</a> uuc)</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;{</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;  <a class="code" href="structopennsl__vxlan__vpn__config__s.html" title="VXLAN VPN Config Structure.">opennsl_vxlan_vpn_config_t</a> vpn_info;</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;  <a class="code" href="group__error.html#gac798c5c818a3213c27d2900d47add7f9" title="OPENNSL API error codes.">opennsl_error_t</a> rv = <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;  <a class="code" href="group__vxlan.html#ga6714301b6f97f14df45b8e96f26cbae8" title="Initialize VXLAN VPN config structure.">opennsl_vxlan_vpn_config_t_init</a>(&amp;vpn_info);</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;  vpn_info.<a class="code" href="structopennsl__vxlan__vpn__config__s.html#a16136c29ade623ced30606f46e7ff6d5" title="OPENNSL_VXLAN_VPN_xxx.">flags</a> = <a class="code" href="group__vxlan.html#ga40d3a155a0639cf603ce0fddc8765e87">OPENNSL_VXLAN_VPN_ELAN</a> | <a class="code" href="group__vxlan.html#ga91cf169bff8103ae7e80bf2f437a3725">OPENNSL_VXLAN_VPN_WITH_ID</a> |</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;                   <a class="code" href="group__vxlan.html#gad5f555e90830304d8338b723f9239698">OPENNSL_VXLAN_VPN_WITH_VPNID</a>;</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;  vpn_info.<a class="code" href="structopennsl__vxlan__vpn__config__s.html#afbf3610c95f5cf94a92c79259b65211c" title="VXLAN VPN.">vpn</a>  = vpn_id;</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;  vpn_info.<a class="code" href="structopennsl__vxlan__vpn__config__s.html#a662233db9e571082acf8eeb89d495a68" title="VNID.">vnid</a> = vnid;</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;  vpn_info.<a class="code" href="structopennsl__vxlan__vpn__config__s.html#a497586a6d6f0ce3195a29975068e1461">broadcast_group</a>         = bc;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;  vpn_info.<a class="code" href="structopennsl__vxlan__vpn__config__s.html#afa48be63476fbb0faff6317d8748446c">unknown_multicast_group</a> = mc;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;  vpn_info.<a class="code" href="structopennsl__vxlan__vpn__config__s.html#a1105297de06ffd03b750d7f46c8ea12d">unknown_unicast_group</a>   = uuc;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;  rv = <a class="code" href="group__vxlan.html#ga7a04195dfb41f6db86a90a1b865962c8" title="Create or update VXLAN VPN.">opennsl_vxlan_vpn_create</a>(unit, &amp;vpn_info);</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>)</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  {</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    printf(<span class="stringliteral">&quot;create_vxlan_vpn: failed to create VXLAN VPN rv %d\n&quot;</span>, rv);</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  }</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;  <span class="keywordflow">return</span> rv;</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;}</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;<span class="comment">/* __doxy_func_body_end__ */</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="comment">/*****************************************************************/</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> create_vxlan_acc_vp(<span class="keywordtype">int</span> unit, <a class="code" href="group__types.html#ga6cdac91ca2a0f776faf2ec43ea898ad5" title="opennsl_vpn_t">opennsl_vpn_t</a> vpn, <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> flags, </div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;                               <a class="code" href="group__types.html#ga238c767c6c5b6a0a47dd9d1504936cf0" title="GPORT (generic port) definitions.">opennsl_gport_t</a> <a class="code" href="opennsl__api_8dox.html#abd1fe5382f13606db566da3450b351b0">port</a>,</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;                               <a class="code" href="group__vxlan.html#gaf19a879f9ff312af35a9035c1cad81a0" title="VXLAN port match criteria.">opennsl_vxlan_port_match_t</a> criteria,</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;                               <a class="code" href="group__types.html#gaca0e18617c36271957788ac01ba44c2e" title="opennsl_if_t">opennsl_if_t</a> egr_obj, <a class="code" href="group__types.html#gaff94709d1708a51eb9aadb2e9fa03875" title="opennsl_vlan_t">opennsl_vlan_t</a> vid, </div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;                               <a class="code" href="group__types.html#ga238c767c6c5b6a0a47dd9d1504936cf0" title="GPORT (generic port) definitions.">opennsl_gport_t</a> *vp)</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;{</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;  <a class="code" href="structopennsl__vxlan__port__s.html" title="VXLAN Gport.">opennsl_vxlan_port_t</a> vxlan_port;</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  <a class="code" href="group__error.html#gac798c5c818a3213c27d2900d47add7f9" title="OPENNSL API error codes.">opennsl_error_t</a> rv = <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  <a class="code" href="group__vxlan.html#gabb37c026d44cf86b88db9b746864678c" title="Initialize VXLAN port structure.">opennsl_vxlan_port_t_init</a>(&amp;vxlan_port);</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;  vxlan_port.<a class="code" href="structopennsl__vxlan__port__s.html#ab25ba86e1f740cefc25bcfe66511afb0" title="OPENNSL_VXLAN_PORT_xxx.">flags</a> = <a class="code" href="group__vxlan.html#ga029b6965e196a809b181b56593368c47" title="Service tag mode.">OPENNSL_VXLAN_PORT_SERVICE_TAGGED</a> | flags;</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;  vxlan_port.<a class="code" href="structopennsl__vxlan__port__s.html#a7db9ca71d49c4d5adb2452eb7f37bd69" title="Match port / trunk.">match_port</a> =        <a class="code" href="opennsl__api_8dox.html#abd1fe5382f13606db566da3450b351b0">port</a>;</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;  vxlan_port.<a class="code" href="structopennsl__vxlan__port__s.html#a55833885a33e3b4564f244eb739366f0" title="Match criteria.">criteria</a> =          criteria;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;  vxlan_port.<a class="code" href="structopennsl__vxlan__port__s.html#abede24b43e4492ea401abe937bc24b47" title="VXLAN egress object.">egress_if</a> =         egr_obj;</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;  vxlan_port.<a class="code" href="structopennsl__vxlan__port__s.html#a83ec19441b48299030f5bf9814223cbb" title="Outer VLAN ID to match.">match_vlan</a> =        vid;</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;  rv = <a class="code" href="group__vxlan.html#ga436707cb4c75c0ecf856e2859f878ef5" title="opennsl_vxlan_port_add adds a Access or Network VXLAN port.">opennsl_vxlan_port_add</a>(unit, vpn, &amp;vxlan_port);</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;  *vp = vxlan_port.<a class="code" href="structopennsl__vxlan__port__s.html#ad75a73a038313fbb6412b11c99a8410b" title="GPORT identifier.">vxlan_port_id</a>;</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;  <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>)</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;  {</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    printf(<span class="stringliteral">&quot;create_vxlan_acc_vp: failed to create vxlan port rv %d\n&quot;</span>, rv);</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;  }</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;  <span class="keywordflow">return</span> rv;</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;}</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;<span class="comment">/* __doxy_func_body_end__ */</span></div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;<span class="comment">/*****************************************************************/</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> create_vxlan_net_vp(<span class="keywordtype">int</span> unit, <a class="code" href="group__types.html#ga6cdac91ca2a0f776faf2ec43ea898ad5" title="opennsl_vpn_t">opennsl_vpn_t</a> vpn, <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> flags, <a class="code" href="group__types.html#ga238c767c6c5b6a0a47dd9d1504936cf0" title="GPORT (generic port) definitions.">opennsl_gport_t</a> port,</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                               <a class="code" href="group__vxlan.html#gaf19a879f9ff312af35a9035c1cad81a0" title="VXLAN port match criteria.">opennsl_vxlan_port_match_t</a> criteria, <a class="code" href="group__types.html#gaca0e18617c36271957788ac01ba44c2e" title="opennsl_if_t">opennsl_if_t</a> egr_obj,</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                               <a class="code" href="group__types.html#ga238c767c6c5b6a0a47dd9d1504936cf0" title="GPORT (generic port) definitions.">opennsl_gport_t</a> tun_init, <a class="code" href="group__types.html#ga238c767c6c5b6a0a47dd9d1504936cf0" title="GPORT (generic port) definitions.">opennsl_gport_t</a> tun_term, </div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;                               <a class="code" href="group__types.html#ga238c767c6c5b6a0a47dd9d1504936cf0" title="GPORT (generic port) definitions.">opennsl_gport_t</a> *vp)</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;{</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;  <a class="code" href="structopennsl__vxlan__port__s.html" title="VXLAN Gport.">opennsl_vxlan_port_t</a> vxlan_port;</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;  <a class="code" href="group__error.html#gac798c5c818a3213c27d2900d47add7f9" title="OPENNSL API error codes.">opennsl_error_t</a> rv = <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;  <a class="code" href="group__vxlan.html#gabb37c026d44cf86b88db9b746864678c" title="Initialize VXLAN port structure.">opennsl_vxlan_port_t_init</a>(&amp;vxlan_port);</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;  vxlan_port.<a class="code" href="structopennsl__vxlan__port__s.html#ab25ba86e1f740cefc25bcfe66511afb0" title="OPENNSL_VXLAN_PORT_xxx.">flags</a> = <a class="code" href="group__vxlan.html#gabc6fe5af508cc9e898aa992bdf981db1" title="Network facing interface.">OPENNSL_VXLAN_PORT_NETWORK</a> | </div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;                     <a class="code" href="group__vxlan.html#ga970a0937f71cff5f48e85b2be086aeb2" title="Specified Egress tunnel is valid.">OPENNSL_VXLAN_PORT_EGRESS_TUNNEL</a> |</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;                     <a class="code" href="group__vxlan.html#ga029b6965e196a809b181b56593368c47" title="Service tag mode.">OPENNSL_VXLAN_PORT_SERVICE_TAGGED</a> | flags;</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  vxlan_port.<a class="code" href="structopennsl__vxlan__port__s.html#a7db9ca71d49c4d5adb2452eb7f37bd69" title="Match port / trunk.">match_port</a> =        <a class="code" href="opennsl__api_8dox.html#abd1fe5382f13606db566da3450b351b0">port</a>;</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  vxlan_port.<a class="code" href="structopennsl__vxlan__port__s.html#a55833885a33e3b4564f244eb739366f0" title="Match criteria.">criteria</a> =          criteria;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  vxlan_port.<a class="code" href="structopennsl__vxlan__port__s.html#abede24b43e4492ea401abe937bc24b47" title="VXLAN egress object.">egress_if</a> =         egr_obj;</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  vxlan_port.<a class="code" href="structopennsl__vxlan__port__s.html#a66bd0455a644c92731efa6997b53d709" title="Tunnel Initiator ID.">egress_tunnel_id</a> =  tun_init;</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  vxlan_port.<a class="code" href="structopennsl__vxlan__port__s.html#aa3c53f3028118b7e98d3547e179e25eb" title="Tunnel Terminator ID.">match_tunnel_id</a> =   tun_term;</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  rv = <a class="code" href="group__vxlan.html#ga436707cb4c75c0ecf856e2859f878ef5" title="opennsl_vxlan_port_add adds a Access or Network VXLAN port.">opennsl_vxlan_port_add</a>(unit, vpn, &amp;vxlan_port);</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;  *vp = vxlan_port.<a class="code" href="structopennsl__vxlan__port__s.html#ad75a73a038313fbb6412b11c99a8410b" title="GPORT identifier.">vxlan_port_id</a>;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;  <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>)</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  {</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    printf(<span class="stringliteral">&quot;create_vxlan_net_vp: failed to create vxlan port rv %d\n&quot;</span>, rv);</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;  }</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;  <span class="keywordflow">return</span> rv;</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;}</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;<span class="comment">/* __doxy_func_body_end__ */</span></div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="comment">/*****************************************************************/</span></div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> add_to_l2_station(<span class="keywordtype">int</span> unit, <a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a> mac, <a class="code" href="group__types.html#gaff94709d1708a51eb9aadb2e9fa03875" title="opennsl_vlan_t">opennsl_vlan_t</a> vid)</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;{</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;  <a class="code" href="structopennsl__l2__station__s.html" title="L2 Station address info.">opennsl_l2_station_t</a> l2_station;</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;  <span class="keywordtype">int</span> station_id;</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;  <a class="code" href="group__error.html#gac798c5c818a3213c27d2900d47add7f9" title="OPENNSL API error codes.">opennsl_error_t</a> rv = <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;  <a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a> bc_mac_mask = {0xff, 0xff, 0xff, 0xff, 0xff, 0xff};</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;  <a class="code" href="group__l2.html#ga237f10dccfaf6f29a0c4ccee74a3ed8e" title="Initialize L2 Station structure.">opennsl_l2_station_t_init</a>(&amp;l2_station);</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;  memcpy(l2_station.<a class="code" href="structopennsl__l2__station__s.html#ac294283242a88ad175d25e02f621d5f5" title="Destination MAC address to match.">dst_mac</a>, mac, <span class="keyword">sizeof</span>(<a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a>));</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;  memcpy(l2_station.<a class="code" href="structopennsl__l2__station__s.html#ace249a6805ad70b11bef4ee29358d93b" title="Destination MAC address mask value.">dst_mac_mask</a>, bc_mac_mask, <span class="keyword">sizeof</span>(<a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a>));</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;  l2_station.<a class="code" href="structopennsl__l2__station__s.html#afae2da66542a8267711e9c33265d0c16" title="VLAN to match.">vlan</a>         = vid;</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;  l2_station.<a class="code" href="structopennsl__l2__station__s.html#a42011f54c5fd03cd3c6bf292b14e9af5" title="VLAN mask value.">vlan_mask</a>    = 0xfff;</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;  l2_station.<a class="code" href="structopennsl__l2__station__s.html#a2eb42681485db17c250d2aab2481403d" title="OPENNSL_L2_STATION_xxx flags.">flags</a>        = <a class="code" href="group__l2.html#gadd4f59f30875eda41faeacea3b2b1be3" title="Subject packets matching this entry to L3 processing.">OPENNSL_L2_STATION_IPV4</a>;</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;  rv = <a class="code" href="group__l2.html#ga8b8c76a2dd59776079dba4e8e25b681c" title="Add an entry to L2 Station table.">opennsl_l2_station_add</a>(unit, &amp;station_id, &amp;l2_station);</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;  <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>)</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;  {</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    printf(<span class="stringliteral">&quot;add_to_l2_station: failed to create l2 entry rv %d\n&quot;</span>, rv);</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;  }</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;  <span class="keywordflow">return</span> rv;</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;}</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="comment">/* __doxy_func_body_end__ */</span></div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="comment">/*****************************************************************/</span></div>
<div class="line"><a name="l00344"></a><span class="lineno"><a class="code" href="example__vxlan_8c.html#a062f7ae8c9c074eec9753297ea4734fb">  344</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="example__vxlan_8c.html#a062f7ae8c9c074eec9753297ea4734fb" title="Add L2 entry based on the MAC, VPN and physical port.">add_to_l2_table</a>(<span class="keywordtype">int</span> unit, <a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a> mac, <a class="code" href="group__types.html#ga6cdac91ca2a0f776faf2ec43ea898ad5" title="opennsl_vpn_t">opennsl_vpn_t</a> vpn_id, <span class="keywordtype">int</span> port)</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;{</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;  <span class="keywordtype">int</span> rv;</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;  <a class="code" href="structopennsl__l2__addr__s.html" title="Device-independent L2 address structure.">opennsl_l2_addr_t</a> l2_addr;</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;  <a class="code" href="group__l2.html#ga47e819cf5939a8e643ad09505df52071" title="Initialize an L2 address structure to a specified MAC address and VLAN ID.">opennsl_l2_addr_t_init</a>(&amp;l2_addr, mac, vpn_id);</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;  l2_addr.<a class="code" href="structopennsl__l2__addr__s.html#a3c915015c746bbad9799b9a40a51b829" title="OPENNSL_L2_xxx flags.">flags</a> = <a class="code" href="group__l2.html#ga838d2e1cee40e3ae41cd4a59599dd333">OPENNSL_L2_STATIC</a>;</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;  l2_addr.<a class="code" href="structopennsl__l2__addr__s.html#a7546884120ba8ab5dce9348fd9bd819f" title="Zero-based port number.">port</a> = <a class="code" href="opennsl__api_8dox.html#abd1fe5382f13606db566da3450b351b0">port</a>;</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;  rv =  <a class="code" href="group__l2.html#ga4b8920c1c3cf4c0c59bf8f0c5890f7c5" title="Add an L2 address entry to the specified device.">opennsl_l2_addr_add</a>(unit, &amp;l2_addr);</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;  <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>)</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;  {</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    printf(<span class="stringliteral">&quot;add_to_l2_table: failed to create l2 entry rv %d\n&quot;</span>, rv);</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;  }</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;  <span class="keywordflow">return</span> rv;</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;}</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="comment">/* __doxy_func_body_end__ */</span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;<span class="comment">/*****************************************************************/</span></div>
<div class="line"><a name="l00370"></a><span class="lineno"><a class="code" href="example__vxlan_8c.html#a8ddc7e204c5da187b95ce791952d4735">  370</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="example__vxlan_8c.html#a8ddc7e204c5da187b95ce791952d4735" title="Create VLAN and add a port to it.">vlan_create_add_port</a>(<span class="keywordtype">int</span> unit, <span class="keywordtype">int</span> vid, <span class="keywordtype">int</span> port)</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;{</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;  <a class="code" href="struct__shr__pbmp.html">opennsl_pbmp_t</a> pbmp, upbmp;</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;  <a class="code" href="group__error.html#gaa1ed0c76c2846d4d337b3157ff73c823">OPENNSL_IF_ERROR_RETURN</a>(<a class="code" href="group__vlan.html#ga4db9e633ba9c276064768d1718c3062c" title="Allocate and configure a VLAN on the OPENNSL device.">opennsl_vlan_create</a>(unit, vid));</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;  <a class="code" href="group__types.html#gafe134087fe1330ec8fffbe7685f139b8">OPENNSL_PBMP_CLEAR</a>(pbmp);</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;  <a class="code" href="group__types.html#gafe134087fe1330ec8fffbe7685f139b8">OPENNSL_PBMP_CLEAR</a>(upbmp);</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;  <a class="code" href="group__types.html#ga7a3934e09536bcaabfdf0f5aefc48411">OPENNSL_PBMP_PORT_ADD</a>(pbmp, port);</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="group__vlan.html#ga1e7cecaf6718cd174f1b1aef29349340" title="Add ports to the specified VLAN.">opennsl_vlan_port_add</a>(unit, vid, pbmp, upbmp);</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;}</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;<span class="comment">/* __doxy_func_body_end__ */</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="comment">/*****************************************************************/</span></div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> create_l3_interface(<span class="keywordtype">int</span> unit, <a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a> local_mac, <span class="keywordtype">int</span> vid,</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;                               <a class="code" href="group__types.html#gaca0e18617c36271957788ac01ba44c2e" title="opennsl_if_t">opennsl_if_t</a> *intf_id)</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;{</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;  <a class="code" href="structopennsl__l3__intf__s.html" title="L3 Interface Structure.">opennsl_l3_intf_t</a> l3_intf;</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;  <a class="code" href="group__error.html#gac798c5c818a3213c27d2900d47add7f9" title="OPENNSL API error codes.">opennsl_error_t</a> rv = <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;  <span class="comment">/* L3 interface and egress object for access */</span></div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;  <a class="code" href="group__l3.html#gaa92edab97138caed29fe11f4f9b35fa7" title="Initialize a opennsl_l3_intf_t structure.">opennsl_l3_intf_t_init</a>(&amp;l3_intf);</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;  memcpy(l3_intf.<a class="code" href="structopennsl__l3__intf__s.html#ace9be269a08c66e4420c4a11b1689936" title="MAC address.">l3a_mac_addr</a>, local_mac, <span class="keyword">sizeof</span>(<a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a>));</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;  l3_intf.<a class="code" href="structopennsl__l3__intf__s.html#acc865cc8d7ef1ed69ca9d3648ad47c07" title="VLAN ID.">l3a_vid</a> = vid;</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;  rv = <a class="code" href="group__l3.html#ga9706ea196e518e48a9a7940471c7a04d" title="Create a new L3 interface.">opennsl_l3_intf_create</a>(unit, &amp;l3_intf);</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;  *intf_id = l3_intf.<a class="code" href="structopennsl__l3__intf__s.html#aad83eb732b3da244ed88ee02531bea82" title="Interface ID.">l3a_intf_id</a>;</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;  <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>)</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;  {</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    printf(<span class="stringliteral">&quot;create_l3_interface: failed to create L3 intf rv %d\n&quot;</span>, rv);</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;  }</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;  <span class="keywordflow">return</span> rv;</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;}</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;<span class="comment">/* __doxy_func_body_end__ */</span></div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;<span class="comment">/*****************************************************************/</span></div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> create_egr_obj(<span class="keywordtype">int</span> unit, <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> flag, <span class="keywordtype">int</span> l3_if, <a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a> nh_mac,</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;                          <a class="code" href="group__types.html#ga238c767c6c5b6a0a47dd9d1504936cf0" title="GPORT (generic port) definitions.">opennsl_gport_t</a> gport, <span class="keywordtype">int</span> vid, <a class="code" href="group__types.html#gaca0e18617c36271957788ac01ba44c2e" title="opennsl_if_t">opennsl_if_t</a> *egr_obj_id)</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;{</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;  <a class="code" href="group__error.html#gac798c5c818a3213c27d2900d47add7f9" title="OPENNSL API error codes.">opennsl_error_t</a> rv = <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;  <a class="code" href="structopennsl__l3__egress__s.html" title="L3 Egress Structure.">opennsl_l3_egress_t</a> l3_egress;</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;  <a class="code" href="group__l3.html#ga10b5ea766149d2bfdcd9d453939057e5" title="Initialize a opennsl_l3_egress_t structure.">opennsl_l3_egress_t_init</a>(&amp;l3_egress);</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;  l3_egress.<a class="code" href="structopennsl__l3__egress__s.html#ad2020d0ca398d03556c939201f5d1744" title="Interface flags (OPENNSL_L3_TGID, OPENNSL_L3_L2TOCPU).">flags</a> = <a class="code" href="group__l3.html#gaa2311f752b9726433b9a9fe2eee8bc5c" title="Specific for VXLAN Nexthop.">OPENNSL_L3_VXLAN_ONLY</a> | flag;</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;  l3_egress.<a class="code" href="structopennsl__l3__egress__s.html#a495387f57bb66a0b0c38842564af10ec" title="L3 interface (source MAC, tunnel).">intf</a>  = l3_if;</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;  memcpy(l3_egress.<a class="code" href="structopennsl__l3__egress__s.html#a414a0355e3fd86ac89a7f061810f4ce6" title="Next hop forwarding destination mac.">mac_addr</a>,  nh_mac, <span class="keyword">sizeof</span>(<a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a>));</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;  l3_egress.<a class="code" href="structopennsl__l3__egress__s.html#a4559c3254ee6ba88106523dd8c9b4422" title="Next hop vlan id.">vlan</a> = vid;</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;  l3_egress.<a class="code" href="structopennsl__l3__egress__s.html#af53aa7695462aa231d4ba889ad06601a" title="Port packet switched to (if !OPENNSL_L3_TGID).">port</a> = gport;</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;  rv = <a class="code" href="group__l3.html#ga0b4c7fdba7b362a408ba712e6894ee50" title="Create an Egress forwarding object.">opennsl_l3_egress_create</a>(unit, flag, &amp;l3_egress, egr_obj_id);</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;  <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>)</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;  {</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    printf(<span class="stringliteral">&quot;create_egr_obj: failed to create L3 egress object rv %d\n&quot;</span>, rv);</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;  }</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;  <span class="keywordflow">return</span> rv;</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;}</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;<span class="comment">/* __doxy_func_body_end__ */</span></div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;<span class="comment">/*****************************************************************/</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> tunnel_initiator_setup(<span class="keywordtype">int</span> unit, <a class="code" href="group__types.html#gacc0736ffd87ecd28c801537a88e5fd1f" title="opennsl_ip_t">opennsl_ip_t</a> lip, <a class="code" href="group__types.html#gacc0736ffd87ecd28c801537a88e5fd1f" title="opennsl_ip_t">opennsl_ip_t</a> rip,</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;                                  <span class="keywordtype">int</span> dp, <span class="keywordtype">int</span> sp, <span class="keywordtype">int</span> ttl, <span class="keywordtype">int</span> *tid)</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;{</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;  <a class="code" href="structopennsl__tunnel__initiator__s.html" title="L3 tunneling initiator.">opennsl_tunnel_initiator_t</a> tnl_init;</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;  <a class="code" href="group__error.html#gac798c5c818a3213c27d2900d47add7f9" title="OPENNSL API error codes.">opennsl_error_t</a> rv = <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;  <a class="code" href="group__tunnel.html#gaf47bc343029b37da6493ad1608452c49" title="Initialize a opennsl_tunnel_initiator_t structure.">opennsl_tunnel_initiator_t_init</a>(&amp;tnl_init);</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;  tnl_init.<a class="code" href="structopennsl__tunnel__initiator__s.html#a99d41099e966760cce3744d7390e6b5c" title="Tunnel type.">type</a>  = <a class="code" href="group__tunnel.html#gga3e4190fb50ca1bcda4c884af45ca716fac1249e178f6daa961b5ae19195b4b1e1" title="VXLAN Tunnel.">opennslTunnelTypeVxlan</a>;</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;  tnl_init.<a class="code" href="structopennsl__tunnel__initiator__s.html#a8c381d8f2f316b82e1d267f0b6eea3ce" title="Tunnel header TTL.">ttl</a> = ttl;</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;  tnl_init.<a class="code" href="structopennsl__tunnel__initiator__s.html#afb622ffe0e32261607929317b796b188" title="Tunnel header SIP (IPv4).">sip</a> = lip;</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;  tnl_init.<a class="code" href="structopennsl__tunnel__initiator__s.html#ae197f0e3771f255246a3b926d77d44d8" title="Tunnel header DIP (IPv4).">dip</a> = rip;</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;  tnl_init.<a class="code" href="structopennsl__tunnel__initiator__s.html#aeb7589088376cfffcc94519380990216" title="Destination UDP port.">udp_dst_port</a> = dp;</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;  tnl_init.<a class="code" href="structopennsl__tunnel__initiator__s.html#a9373ad16f5908eb6d1311233156022bb" title="Source UDP port.">udp_src_port</a> = sp;</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;  rv = <a class="code" href="group__vxlan.html#ga0abe7a23a0c1aae0d7699d684dfc835b" title="Create VXLAN Tunnel Initiator.">opennsl_vxlan_tunnel_initiator_create</a>(unit, &amp;tnl_init);</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;  <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>)</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;  {</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    printf(<span class="stringliteral">&quot;tunnel_initiator_setup: failed to create VXLAN tunnel initiator rv %d\n&quot;</span>, rv);</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;  }</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;  *tid = tnl_init.<a class="code" href="structopennsl__tunnel__initiator__s.html#ace61a09c712a58a55daaa3ffec6a9682" title="Tunnel ID.">tunnel_id</a>;</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;  <span class="keywordflow">return</span> rv;</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;}</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;<span class="comment">/* __doxy_func_body_end__ */</span></div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;<span class="comment">/*****************************************************************/</span></div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> tunnel_terminator_setup(<span class="keywordtype">int</span> unit, <a class="code" href="group__types.html#gacc0736ffd87ecd28c801537a88e5fd1f" title="opennsl_ip_t">opennsl_ip_t</a> rip, <a class="code" href="group__types.html#gacc0736ffd87ecd28c801537a88e5fd1f" title="opennsl_ip_t">opennsl_ip_t</a> lip,</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    <a class="code" href="group__types.html#gaff94709d1708a51eb9aadb2e9fa03875" title="opennsl_vlan_t">opennsl_vlan_t</a> net_vid, <span class="keywordtype">int</span> tunnel_init_id, <span class="keywordtype">int</span> *term_id)</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;{</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;  <a class="code" href="structopennsl__tunnel__terminator__s.html" title="L3 tunneling terminator.">opennsl_tunnel_terminator_t</a> tnl_term;</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;  <a class="code" href="group__error.html#gac798c5c818a3213c27d2900d47add7f9" title="OPENNSL API error codes.">opennsl_error_t</a> rv = <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;  <a class="code" href="group__tunnel.html#gae9a2149c3e68ae37b11739ea199f08f5" title="Initialize a opennsl_tunnel_terminator_t structure.">opennsl_tunnel_terminator_t_init</a>(&amp;tnl_term);</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;  tnl_term.<a class="code" href="structopennsl__tunnel__terminator__s.html#abcc9831103f029841cd0821ec0b0988b" title="Tunnel type.">type</a> = <a class="code" href="group__tunnel.html#gga3e4190fb50ca1bcda4c884af45ca716fac1249e178f6daa961b5ae19195b4b1e1" title="VXLAN Tunnel.">opennslTunnelTypeVxlan</a>;</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;  tnl_term.<a class="code" href="structopennsl__tunnel__terminator__s.html#a5cbcb1eaa0a16ebc96c576dfc73421b5" title="SIP for tunnel header match.">sip</a> = rip;    <span class="comment">/* For MC tunnel, Don&#39;t care */</span></div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;  tnl_term.<a class="code" href="structopennsl__tunnel__terminator__s.html#a57a7d057bf79bbcfed4db60fd9236b7e" title="DIP for tunnel header match.">dip</a> = lip;</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;  tnl_term.<a class="code" href="structopennsl__tunnel__terminator__s.html#ad41b511de63a2839f30511f2f03c5302" title="Tunnel id.">tunnel_id</a> = tunnel_init_id;</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;  tnl_term.<a class="code" href="structopennsl__tunnel__terminator__s.html#a8eb25fd225a784f420cced44546c08d4" title="Configuration flags.">flags</a> = <a class="code" href="group__tunnel.html#ga07fc2c2aa4e65af0ddb9f2fca9b0f4f0" title="Create tunnel with ID.">OPENNSL_TUNNEL_TERM_TUNNEL_WITH_ID</a>;</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;  <span class="keywordflow">if</span> (net_vid != -1) {</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    tnl_term.<a class="code" href="structopennsl__tunnel__terminator__s.html#afd287480cd689441bf7c394c37d6023e" title="The VLAN ID for IPMC lookup or WLAN tunnel.">vlan</a> = net_vid;  <span class="comment">/* MC tunnel only - for Bud check */</span></div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;  }</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;  rv = <a class="code" href="group__vxlan.html#gab330353b817ed5c343a895905d1e8d94" title="Create VXLAN Tunnel terminator.">opennsl_vxlan_tunnel_terminator_create</a>(unit, &amp;tnl_term);</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;  *term_id = tnl_term.<a class="code" href="structopennsl__tunnel__terminator__s.html#ad41b511de63a2839f30511f2f03c5302" title="Tunnel id.">tunnel_id</a>;</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;  <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>)</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;  {</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;    printf(<span class="stringliteral">&quot;tunnel_terminator_setup: failed to create VXLAN tunnel terminator rv %d\n&quot;</span>, rv);</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;  }</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;  <span class="keywordflow">return</span> rv;</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;}</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;<span class="comment">/* __doxy_func_body_end__ */</span></div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;<span class="comment">/*****************************************************************/</span></div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> example_vxlan(<a class="code" href="group__types.html#gacaeba2b4ddbc89b0e556720a9388885f" title="Set the default tag protocol ID (TPID) for the specified port.">opennsl_port_t</a> a_port1, <a class="code" href="group__types.html#gacaeba2b4ddbc89b0e556720a9388885f" title="Set the default tag protocol ID (TPID) for the specified port.">opennsl_port_t</a> a_port2,</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;    <a class="code" href="group__types.html#gacaeba2b4ddbc89b0e556720a9388885f" title="Set the default tag protocol ID (TPID) for the specified port.">opennsl_port_t</a> n_port)</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;{</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;  <span class="keywordtype">int</span> unit = <a class="code" href="example__vxlan_8c.html#adbb76aecfc5eef000cb4cb55bc2fd404">DEFAULT_UNIT</a>;</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;  <span class="comment">/* VPN IDs */</span></div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;  <a class="code" href="group__types.html#ga6cdac91ca2a0f776faf2ec43ea898ad5" title="opennsl_vpn_t">opennsl_vpn_t</a> vpn_id_1 = 0x7010, vpn_id_2 = 0x7020;</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;  <span class="keywordtype">int</span> vnid_1 = 0x12345, vnid_2 = 0x53535;</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;  <a class="code" href="group__types.html#ga50bad717e3851cb2dd6acaac4d2a2f1b" title="opennsl_multicast_t">opennsl_multicast_t</a> bc_group_1 = 0, bc_group_2 = 0;</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;  <span class="comment">/* Used to create a dummy VPN that is used to create network VP */</span></div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;  <span class="keywordtype">int</span> rsvd_network_vpn = 0x7001;</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;  <span class="keywordtype">int</span> rsvd_network_vpn_vnid = 0xeeee;</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;  <span class="comment">/* Access side */</span></div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;  <span class="comment">/* Access side MAC addresses are not really used */</span></div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;  <a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a> acc_dummy_mac = {0x00, 0x00, 0x01, 0x00, 0x00, 0x01};</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;  <a class="code" href="group__types.html#gacaeba2b4ddbc89b0e556720a9388885f" title="Set the default tag protocol ID (TPID) for the specified port.">opennsl_port_t</a> acc_port_1 = a_port1;          <span class="comment">/* access 1 */</span></div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;  <a class="code" href="group__types.html#gaff94709d1708a51eb9aadb2e9fa03875" title="opennsl_vlan_t">opennsl_vlan_t</a> acc_vid_1 = 21;</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;  <a class="code" href="group__types.html#gaca0e18617c36271957788ac01ba44c2e" title="opennsl_if_t">opennsl_if_t</a> acc_intf_id_1 = a_port1;</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;  <a class="code" href="group__types.html#ga238c767c6c5b6a0a47dd9d1504936cf0" title="GPORT (generic port) definitions.">opennsl_gport_t</a> acc_gport_1 = <a class="code" href="group__types.html#ga14e03ebb50d7d83f78e289cc2f49c3e1">OPENNSL_GPORT_INVALID</a>;</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;  <a class="code" href="group__types.html#gaca0e18617c36271957788ac01ba44c2e" title="opennsl_if_t">opennsl_if_t</a> acc_egr_obj_1;</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;  <span class="keywordtype">int</span> acc_vxlan_port_1;</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;  <a class="code" href="group__types.html#gaca0e18617c36271957788ac01ba44c2e" title="opennsl_if_t">opennsl_if_t</a> acc_encap_id_1;</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;  <a class="code" href="group__types.html#gacaeba2b4ddbc89b0e556720a9388885f" title="Set the default tag protocol ID (TPID) for the specified port.">opennsl_port_t</a> acc_port_2 = a_port2;          <span class="comment">/* access 2 */</span></div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;  <a class="code" href="group__types.html#gaff94709d1708a51eb9aadb2e9fa03875" title="opennsl_vlan_t">opennsl_vlan_t</a> acc_vid_2 = 20;</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;  <a class="code" href="group__types.html#gaca0e18617c36271957788ac01ba44c2e" title="opennsl_if_t">opennsl_if_t</a> acc_intf_id_2 = a_port2;</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;  <a class="code" href="group__types.html#ga238c767c6c5b6a0a47dd9d1504936cf0" title="GPORT (generic port) definitions.">opennsl_gport_t</a> acc_gport_2 = <a class="code" href="group__types.html#ga14e03ebb50d7d83f78e289cc2f49c3e1">OPENNSL_GPORT_INVALID</a>;</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;  <a class="code" href="group__types.html#gaca0e18617c36271957788ac01ba44c2e" title="opennsl_if_t">opennsl_if_t</a> acc_egr_obj_2;</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;  <span class="keywordtype">int</span> acc_vxlan_port_2;</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;  <a class="code" href="group__types.html#gaca0e18617c36271957788ac01ba44c2e" title="opennsl_if_t">opennsl_if_t</a> acc_encap_id_2;</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;  <span class="comment">/* Network side */</span></div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;  <a class="code" href="group__types.html#gacaeba2b4ddbc89b0e556720a9388885f" title="Set the default tag protocol ID (TPID) for the specified port.">opennsl_port_t</a> net_port = n_port;</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;  <a class="code" href="group__types.html#gaff94709d1708a51eb9aadb2e9fa03875" title="opennsl_vlan_t">opennsl_vlan_t</a> net_vid = 22;</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;  <a class="code" href="group__types.html#gaca0e18617c36271957788ac01ba44c2e" title="opennsl_if_t">opennsl_if_t</a> net_intf_id = n_port;</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;  <a class="code" href="group__types.html#ga238c767c6c5b6a0a47dd9d1504936cf0" title="GPORT (generic port) definitions.">opennsl_gport_t</a> net_gport = <a class="code" href="group__types.html#ga14e03ebb50d7d83f78e289cc2f49c3e1">OPENNSL_GPORT_INVALID</a>;</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;  <a class="code" href="group__types.html#gaca0e18617c36271957788ac01ba44c2e" title="opennsl_if_t">opennsl_if_t</a> net_egr_obj;</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;  <span class="keywordtype">int</span> net_vxlan_port;</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;  <span class="comment">/* UC Tunnel */</span></div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;  <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> ttl = 16;</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;  <a class="code" href="sal_2types_8h.html#a05f6b0ae8f6a6e135b0e290c25fe0e4e">uint16</a> udp_dp = <a class="code" href="example__vxlan_8c.html#a6771677c2de7aeda8be146d9068290e3">VXLAN_UDP_DEST_PORT</a>;</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;  <a class="code" href="sal_2types_8h.html#a05f6b0ae8f6a6e135b0e290c25fe0e4e">uint16</a> udp_sp = 0xffff;</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;  <a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a> net_local_mac = {0x00, 0x00, 0x00, 0x00, 0x22, 0x22};</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;  <a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a> net_remote_mac = {0x00, 0x00, 0x00, 0x00, 0x00, 0x02};</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;  <a class="code" href="group__types.html#gacc0736ffd87ecd28c801537a88e5fd1f" title="opennsl_ip_t">opennsl_ip_t</a> tnl_local_ip = 0x0a0a0a01;     <span class="comment">/* 10.10.10.1 */</span></div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;  <a class="code" href="group__types.html#gacc0736ffd87ecd28c801537a88e5fd1f" title="opennsl_ip_t">opennsl_ip_t</a> tnl_remote_ip = 0xC0A80101;    <span class="comment">/* 192.168.1.1 */</span></div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;  <span class="keywordtype">int</span> tunnel_init_id, tunnel_term_id;</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;  <span class="comment">/* DLF/BC tunnel and virtual port */</span></div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;  <a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a> dlf_mac = {0x01, 0x00, 0x5e, 0x00, 0x00, 0x0A}; <span class="comment">/* 224.0.0.10 */</span></div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;  <a class="code" href="group__types.html#gacc0736ffd87ecd28c801537a88e5fd1f" title="opennsl_ip_t">opennsl_ip_t</a> tnl_mc_dip = 0xe000000A; <span class="comment">/* 224.0.0.10 */</span></div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;  <a class="code" href="group__types.html#gaca0e18617c36271957788ac01ba44c2e" title="opennsl_if_t">opennsl_if_t</a> egr_obj_mc;</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;  <span class="keywordtype">int</span> vxlan_port_mc;</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;  <a class="code" href="group__types.html#gaca0e18617c36271957788ac01ba44c2e" title="opennsl_if_t">opennsl_if_t</a> encap_id_mc;</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;  <span class="keywordtype">int</span> tunnel_mc_init_id, tunnel_mc_term_id;</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;  <span class="comment">/* Payment MAC from access 1 */</span></div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;  <a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a> payload_sa_1 = {0x00, 0x00, 0x00, 0x00, 0x11, 0xaa};</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;  <a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a> payload_da_1 = {0x00, 0x00, 0x00, 0x00, 0x11, 0xbb};</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;  <span class="comment">/* Payment MAC from access 2 */</span></div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;  <a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a> payload_sa_2 = {0x00, 0x00, 0x00, 0x00, 0x22, 0xaa};</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;  <a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a> payload_da_2 = {0x00, 0x00, 0x00, 0x00, 0x22, 0xbb};</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;  <span class="comment">/* Global settings */</span></div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;  do_vxlan_global_setting(unit);</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;  <span class="comment">/* Access port settings */</span></div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;  do_vxlan_access_port_settings(unit, acc_port_1);</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;  do_vxlan_access_port_settings(unit, acc_port_2);</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;  <span class="comment">/* Network port settings */</span></div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;  do_vxlan_net_port_settings(unit, net_port);</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;  <a class="code" href="group__port.html#gac3b1ddc83dbed38868b5ba256d29cdf7" title="Get the GPORT ID for the specified local port number.">opennsl_port_gport_get</a>(unit, acc_port_1, &amp;acc_gport_1);</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;  <a class="code" href="group__port.html#gac3b1ddc83dbed38868b5ba256d29cdf7" title="Get the GPORT ID for the specified local port number.">opennsl_port_gport_get</a>(unit, acc_port_2, &amp;acc_gport_2);</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;  <a class="code" href="group__port.html#gac3b1ddc83dbed38868b5ba256d29cdf7" title="Get the GPORT ID for the specified local port number.">opennsl_port_gport_get</a>(unit, net_port, &amp;net_gport);</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;  <span class="comment">/* Multicast group for segment BC/DLF/MC */</span></div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;  <a class="code" href="group__multicast.html#ga9134d19d090cf0b13f883abc1edf606c" title="Create a multicast group for packet replication.">opennsl_multicast_create</a>(unit, <a class="code" href="group__multicast.html#ga70c82010da013c1265eaaa4bf661ebb2">OPENNSL_MULTICAST_TYPE_VXLAN</a>, &amp;bc_group_1);</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;  <a class="code" href="group__multicast.html#ga9134d19d090cf0b13f883abc1edf606c" title="Create a multicast group for packet replication.">opennsl_multicast_create</a>(unit, <a class="code" href="group__multicast.html#ga70c82010da013c1265eaaa4bf661ebb2">OPENNSL_MULTICAST_TYPE_VXLAN</a>, &amp;bc_group_2);</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;  <span class="comment">/* Create VXLAN VPNs */</span></div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;  create_vxlan_vpn(unit, vpn_id_1, vnid_1, bc_group_1, bc_group_1, bc_group_1);</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;  create_vxlan_vpn(unit, vpn_id_2, vnid_2, bc_group_2, bc_group_2, bc_group_2);</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;  <span class="comment">/* Create VXLAN VPN for assigning Network-VP */</span></div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;  create_vxlan_vpn(unit, rsvd_network_vpn, rsvd_network_vpn_vnid, bc_group_2,</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;                   bc_group_2, bc_group_2);</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;  <span class="comment">/* Create access side VXLAN port 1 (belongs to VPN 1) */</span></div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;  <span class="comment">/* VLAN settings */</span></div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;  <a class="code" href="example__vxlan_8c.html#a8ddc7e204c5da187b95ce791952d4735" title="Create VLAN and add a port to it.">vlan_create_add_port</a>(unit, acc_vid_1, acc_port_1);</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;  <span class="comment">/* L3 interface and egress object for access 1 - note use a dummy MAC address */</span></div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;  create_l3_interface(unit, acc_dummy_mac, acc_vid_1, &amp;acc_intf_id_1);</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;  create_egr_obj(unit, 0, acc_intf_id_1, acc_dummy_mac,</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;                 acc_gport_1, acc_vid_1, &amp;acc_egr_obj_1);</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;  <span class="comment">/* Create VXLAN VP for access port 1 */</span></div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;  create_vxlan_acc_vp(unit, vpn_id_1, 0, acc_gport_1, <a class="code" href="group__vxlan.html#gga4600e13897e04ce6c7eef1ea4c52a97aacd7c461c631c617fc7729eb13076e4ee" title="{Module, Port} or Trunk.">OPENNSL_VXLAN_PORT_MATCH_PORT</a>,</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;                      acc_egr_obj_1, acc_vid_1, &amp;acc_vxlan_port_1);</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;  <span class="comment">/* Create access side VXLAN port 2 (belongs to VPN 2) */</span></div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;  <span class="comment">/* VLAN settings */</span></div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;  <a class="code" href="example__vxlan_8c.html#a8ddc7e204c5da187b95ce791952d4735" title="Create VLAN and add a port to it.">vlan_create_add_port</a>(unit, acc_vid_2, acc_port_2);</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;  <span class="comment">/* L3 interface and egress object for access 2 - note use a dummy MAC address */</span></div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;  create_l3_interface(unit, acc_dummy_mac, acc_vid_2, &amp;acc_intf_id_2);</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;  create_egr_obj(unit, 0, acc_intf_id_2, acc_dummy_mac,</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;                 acc_gport_2, acc_vid_2, &amp;acc_egr_obj_2);</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;  <span class="comment">/* Create VXLAN VP for access port 2 */</span></div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;  create_vxlan_acc_vp(unit, vpn_id_2, 0, acc_gport_2, <a class="code" href="group__vxlan.html#gga4600e13897e04ce6c7eef1ea4c52a97aacd7c461c631c617fc7729eb13076e4ee" title="{Module, Port} or Trunk.">OPENNSL_VXLAN_PORT_MATCH_PORT</a>,</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;                      acc_egr_obj_2, acc_vid_2, &amp;acc_vxlan_port_2);</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;  <span class="comment">/* The network tunnel is shared by the two VPNs */</span></div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;  <span class="comment">/* VLAN settings */</span></div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;  <a class="code" href="example__vxlan_8c.html#a8ddc7e204c5da187b95ce791952d4735" title="Create VLAN and add a port to it.">vlan_create_add_port</a>(unit, net_vid, net_port);</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;  <span class="comment">/* L3 interface and egress object for network */</span></div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;  create_l3_interface(unit, net_local_mac, net_vid, &amp;net_intf_id);</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;  create_egr_obj(unit, 0, net_intf_id, net_remote_mac, net_gport,</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;                 net_vid, &amp;net_egr_obj);</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;  <span class="comment">/* Tunnel Setup (Initiator &amp; Terminator - UC) */</span></div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;  tunnel_initiator_setup(unit, tnl_local_ip, tnl_remote_ip, udp_dp, udp_sp, ttl, &amp;tunnel_init_id);</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;  tunnel_terminator_setup(unit, tnl_remote_ip, tnl_local_ip, -1, tunnel_init_id, &amp;tunnel_term_id);</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;  <span class="comment">/* Create VXLAN VP for network port */</span></div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;  create_vxlan_net_vp(unit, rsvd_network_vpn, 0, net_gport, <a class="code" href="group__vxlan.html#gga4600e13897e04ce6c7eef1ea4c52a97aa95dd2a39582292c5434afce67210ca12" title="Match VXLAN VN_ID.">OPENNSL_VXLAN_PORT_MATCH_VN_ID</a>, net_egr_obj,</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;                      tunnel_init_id, tunnel_term_id, &amp;net_vxlan_port);</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;  <span class="comment">/* Station MAC set up - this will terminate incoming L3 packets on network port */</span></div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;  add_to_l2_station(unit, net_local_mac, net_vid);</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;  <span class="comment">/*</span></div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;<span class="comment">   * DLF/BC network port set up</span></div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;<span class="comment">   */</span></div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;  <span class="comment">/* Egress object for non-UC VXLAN VP, use same interface as UC VXLAN network */</span></div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;  create_egr_obj(unit, <a class="code" href="group__l3.html#ga11efb97e21f394668a625073a16ba8e6" title="Set IPMC for real IPMC entry.">OPENNSL_L3_IPMC</a>, net_intf_id, dlf_mac, net_gport, net_vid, &amp;egr_obj_mc);</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;  <span class="comment">/* Tunnel Setup (Initiator &amp; Terminator - non-UC) */</span></div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;  tunnel_initiator_setup(unit, tnl_local_ip, tnl_mc_dip, udp_dp, udp_sp, ttl, &amp;tunnel_mc_init_id);</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;  tunnel_terminator_setup(unit, tnl_remote_ip, tnl_mc_dip, net_vid,</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;      tunnel_mc_init_id, &amp;tunnel_mc_term_id);</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;  <span class="comment">/* Create non-UC VXLAN VP for network port */</span></div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;  create_vxlan_net_vp(unit, rsvd_network_vpn, <a class="code" href="group__vxlan.html#gae52163c41eb7affb28fe32e108e03391" title="Create Multicast-only VXLAN Tunnel.">OPENNSL_VXLAN_PORT_MULTICAST</a>, net_gport,</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;      <a class="code" href="group__vxlan.html#gga4600e13897e04ce6c7eef1ea4c52a97aada3f8233dbf519882b89cebcd3823f08" title="No source match criteria.">OPENNSL_VXLAN_PORT_MATCH_NONE</a>, egr_obj_mc,</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;      tunnel_mc_init_id, tunnel_mc_term_id, &amp;vxlan_port_mc);</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;  <span class="comment">/* Station MAC set up */</span></div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;  add_to_l2_station(unit, dlf_mac, net_vid);</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;  <span class="comment">/*</span></div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;<span class="comment">   * MC group set up - MC group should contains all Access ports and Network non-UC port</span></div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;<span class="comment">   */</span></div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;  <span class="comment">/* BC group 1 (VPN 1)*/</span></div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;  <a class="code" href="group__multicast.html#gafc7e3a95a0a18021de98480a83aeb351" title="Get the multicast encapsulation ID for VXLAN replication.">opennsl_multicast_vxlan_encap_get</a>(unit, bc_group_1, net_gport, vxlan_port_mc, &amp;encap_id_mc);</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;  <a class="code" href="group__multicast.html#gae60ad27650b6302a5fc73df3af8efaa6" title="Add an encapsulated interface to a multicast group&#39;s replication list on a specific port...">opennsl_multicast_egress_add</a>(unit, bc_group_1, vxlan_port_mc, encap_id_mc);</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;  <a class="code" href="group__multicast.html#gafc7e3a95a0a18021de98480a83aeb351" title="Get the multicast encapsulation ID for VXLAN replication.">opennsl_multicast_vxlan_encap_get</a>(unit, bc_group_1, acc_gport_1, acc_vxlan_port_1, &amp;acc_encap_id_1);</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;  <a class="code" href="group__multicast.html#gae60ad27650b6302a5fc73df3af8efaa6" title="Add an encapsulated interface to a multicast group&#39;s replication list on a specific port...">opennsl_multicast_egress_add</a>(unit, bc_group_1, acc_vxlan_port_1, acc_encap_id_1);</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;  <span class="comment">/* BC group 2 (VPN 2) */</span></div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;  <a class="code" href="group__multicast.html#gafc7e3a95a0a18021de98480a83aeb351" title="Get the multicast encapsulation ID for VXLAN replication.">opennsl_multicast_vxlan_encap_get</a>(unit, bc_group_2, net_gport, vxlan_port_mc, &amp;encap_id_mc);</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;  <a class="code" href="group__multicast.html#gae60ad27650b6302a5fc73df3af8efaa6" title="Add an encapsulated interface to a multicast group&#39;s replication list on a specific port...">opennsl_multicast_egress_add</a>(unit, bc_group_2, vxlan_port_mc, encap_id_mc);</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;  <a class="code" href="group__multicast.html#gafc7e3a95a0a18021de98480a83aeb351" title="Get the multicast encapsulation ID for VXLAN replication.">opennsl_multicast_vxlan_encap_get</a>(unit, bc_group_2, acc_gport_2, acc_vxlan_port_2, &amp;acc_encap_id_2);</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;  <a class="code" href="group__multicast.html#gae60ad27650b6302a5fc73df3af8efaa6" title="Add an encapsulated interface to a multicast group&#39;s replication list on a specific port...">opennsl_multicast_egress_add</a>(unit, bc_group_2, acc_vxlan_port_2, acc_encap_id_2);</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;  <span class="comment">/*</span></div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;<span class="comment">   * Add Payload L2 address to L2 table</span></div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;<span class="comment">   */</span></div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;  <span class="comment">/* Access 1 =&gt; Network */</span></div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;  <a class="code" href="example__vxlan_8c.html#a062f7ae8c9c074eec9753297ea4734fb" title="Add L2 entry based on the MAC, VPN and physical port.">add_to_l2_table</a>(unit, payload_da_1, vpn_id_1, net_vxlan_port);</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;  <span class="comment">/* Network =&gt; Access 1 */</span></div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;  <a class="code" href="example__vxlan_8c.html#a062f7ae8c9c074eec9753297ea4734fb" title="Add L2 entry based on the MAC, VPN and physical port.">add_to_l2_table</a>(unit, payload_sa_1, vpn_id_1, acc_vxlan_port_1);</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;  <span class="comment">/* Access 2 =&gt; Network */</span></div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;  <a class="code" href="example__vxlan_8c.html#a062f7ae8c9c074eec9753297ea4734fb" title="Add L2 entry based on the MAC, VPN and physical port.">add_to_l2_table</a>(unit, payload_da_2, vpn_id_2, net_vxlan_port);</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;  <span class="comment">/* Network =&gt; Access 2 */</span></div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;  <a class="code" href="example__vxlan_8c.html#a062f7ae8c9c074eec9753297ea4734fb" title="Add L2 entry based on the MAC, VPN and physical port.">add_to_l2_table</a>(unit, payload_sa_2, vpn_id_2, acc_vxlan_port_2);</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;}</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;<span class="comment">/* __doxy_func_body_end__ */</span></div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;<span class="comment">/*****************************************************************/</span></div>
<div class="line"><a name="l00748"></a><span class="lineno"><a class="code" href="example__vxlan_8c.html#a0ddf1224851353fc92bfbff6f499fa97">  748</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="example__field__redirect_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="Main function for redirecting traffic based on destination MAC address.">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;{</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;  <a class="code" href="group__error.html#gac798c5c818a3213c27d2900d47add7f9" title="OPENNSL API error codes.">opennsl_error_t</a>   rv;</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;  <span class="keywordtype">int</span> choice;</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;  <span class="keywordtype">int</span> index = 0;</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;  <span class="keywordtype">int</span> unit = <a class="code" href="example__vxlan_8c.html#adbb76aecfc5eef000cb4cb55bc2fd404">DEFAULT_UNIT</a>;</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;  <span class="keywordflow">if</span>(strcmp(argv[0], <span class="stringliteral">&quot;gdb&quot;</span>) == 0)</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;  {</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;    index = 1;</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;  }</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;  <span class="keywordflow">if</span>((argc != (index + 1)) || ((argc &gt; (index + 1)) &amp;&amp; (strcmp(argv[index + 1], <span class="stringliteral">&quot;--help&quot;</span>) == 0))) {</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;    printf(<span class="stringliteral">&quot;%s\n\r&quot;</span>, <a class="code" href="example__field__redirect_8c.html#afc7d01e6dbea2c820a68fb8081c58a89">example_usage</a>);</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a8b380efdb47b4a4b0ebafbb1c7823748">OPENNSL_E_PARAM</a>;</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;  }</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;  <span class="comment">/* Initialize the system. */</span></div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;  printf(<span class="stringliteral">&quot;Initializing the switch device.\r\n&quot;</span>);</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;  rv = <a class="code" href="driver_8h.html#a06a6fe41f5ea8664c461423d3cad0923" title="Function to initialize the switch.">opennsl_driver_init</a>((<a class="code" href="structopennsl__config__s.html">opennsl_init_t</a> *) <a class="code" href="sal_2types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;  <span class="keywordflow">if</span>(rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;    printf(<span class="stringliteral">&quot;\r\nFailed to initialize the switch device. Error %s\r\n&quot;</span>,</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;        <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;    <span class="keywordflow">return</span> rv;</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;  }</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;  <span class="comment">/* cold boot initialization commands */</span></div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;  rv = <a class="code" href="examples_2util_8h.html#a2846e8ec8f46d212a3ae2493bdff7980" title="Set default configuration (like STP state, speed/duplex) for all ports.">example_port_default_config</a>(unit);</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;  <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;    printf(<span class="stringliteral">&quot;\r\nFailed to apply default config on ports, rc = %d (%s).\r\n&quot;</span>,</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;           rv, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;  }</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;  <span class="comment">/* Configure VXLAN settings for access and network ports */</span></div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;  example_vxlan(1, 2, 3);</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;  printf(<span class="stringliteral">&quot;\r\nVxLAN configuration is done successfully\n&quot;</span>);</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;  <span class="keywordflow">while</span> (1) {</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;    printf(<span class="stringliteral">&quot;\r\nUser menu: Select one of the following options\r\n&quot;</span>);</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;<span class="preprocessor">#ifdef INCLUDE_DIAG_SHELL</span></div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;<span class="preprocessor"></span>    printf(<span class="stringliteral">&quot;9. Launch diagnostic shell\n&quot;</span>);</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;<span class="preprocessor"></span>    printf(<span class="stringliteral">&quot;0. Quit the application\n&quot;</span>);</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="examples_2util_8h.html#ad0173c952d5a8af01c14eebabc05b5df" title="Read numeric menu choice from user.">example_read_user_choice</a>(&amp;choice) != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>)</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;    {</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;        printf(<span class="stringliteral">&quot;Invalid option entered. Please re-enter.\n&quot;</span>);</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;    }</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;    <span class="keywordflow">switch</span>(choice){</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;<span class="preprocessor">#ifdef INCLUDE_DIAG_SHELL</span></div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;<span class="preprocessor"></span>      <span class="keywordflow">case</span> 9:</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;      {</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;        opennsl_driver_shell();</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;      }</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;      <span class="keywordflow">case</span> 0:</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;      {</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;        printf(<span class="stringliteral">&quot;Exiting the application.\n&quot;</span>);</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;      }</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;      <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;    } <span class="comment">/* End of switch */</span></div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;  } <span class="comment">/* End of while */</span></div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;}</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;<span class="comment">/* __doxy_func_body_end__ */</span></div>
</div><!-- fragment --></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.5-->
<!-- start footer part -->
<!--BEGIN GENERATE_TREEVIEW -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
<hr>
<p>	
<table class="footer-brcm">
	<tr>
		<td class="footer-brcm"><img src="BRCM_Red+Black_noTag_RGB.png" align=left></td>
		<td class="footer-brcm"><small><b>&copy;  2016 by Broadcom Corporation. All rights reserved.</b></small>
			<div class="footer-brcm"><small>Broadcom Corporation reserves the right to make changes without further notice to any products or data herein to improve reliability, function, or design. 
Information furnished by Broadcom Corporation is believed to be accurate and reliable. However, Broadcom Corporation does not assume any liability arising 
out of the application or use of this information, nor the application or use of any product or circuit described herein, neither does it convey any license 
under its patent rights nor the rights of others. </small>
			</div>
		</td>
	</tr>
</table>	
</p>	
</div>
<!--END GENERATE_TREEVIEW-->
</body>
</html>
